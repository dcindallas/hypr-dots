#!/bin/bash
# Optimized for hypr-dots Bare Repository

CONFIG_CMD="/usr/bin/git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME"

# 1. FORCE STAGE EVERYTHING - This bypasses the broken .gitignore logic
$CONFIG_CMD add -f ~/.config/hypr/ \
                 ~/.config/DankMaterialShell/ \
                 ~/.config/kitty/ \
                 ~/.config/gtk-3.0/ \
                 ~/.config/gtk-4.0/ \
                 ~/.config/matugen/ \
                 ~/.config/cava/ \
                 ~/.config/danksearch/ \
                 ~/.config/starship.toml \
                 ~/.local/bin/ \
                 ~/.gitignore \
                 ~/README.md \
                 ~/GEMINI.md

# 2. FIXED DATE: Using an underscore instead of a space to kill the "extra operand" error
$CONFIG_CMD commit -m "Rice-Update-$(date +%Y-%m-%d_%H:%M)" || echo "No local changes to commit"

# 3. PULL AND REBASE
$CONFIG_CMD pull --rebase --autostash origin main

# 4. PUSH
if $CONFIG_CMD push origin main; then
    notify-send "Rice Sync" "hypr-dots backup successful"
else
    notify-send "Rice Sync" "Push failed - check terminal"
fi
