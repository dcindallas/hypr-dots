#!/bin/bash
# Optimized for hypr-dots Bare Repository

CONFIG_CMD="/usr/bin/git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME"

# 1. FORCE STAGE EVERYTHING (Fixed Starship path and added Cava/GTK)
$CONFIG_CMD add -f ~/.config/hypr/ \
                 ~/.config/DankMaterialShell/ \
                 ~/.config/kitty/ \
                 ~/.config/gtk-3.0/ \
                 ~/.config/gtk-4.0/ \
                 ~/.config/matugen/ \
                 ~/.config/cava/ \
                 ~/.config/danksearch/ \
                 ~/.config/starship/starship.toml \
                 ~/.local/bin/ \
                 ~/.gitignore \
                 ~/README.md \
                 ~/GEMINI.md

# 2. COMMIT WITH ZERO-SPACE DATE (Fixes "extra operand" error)
$CONFIG_CMD commit -m "Update-$(date +%Y%m%d-%H%M%S)" || echo "No local changes"

# 3. PULL AND REBASE
$CONFIG_CMD pull --rebase --autostash origin main

# 4. PUSH
if $CONFIG_CMD push origin main; then
    notify-send "Rice Sync" "hypr-dots backup successful"
else
    notify-send "Rice Sync" "Push failed - check terminal"
fi
