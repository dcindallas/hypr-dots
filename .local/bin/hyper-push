#!/bin/bash
# Optimized for hypr-dots Bare Repository

CONFIG_CMD="/usr/bin/git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME"

# 1. Stage and Commit local changes FIRST
$CONFIG_CMD add -f ~/.config/hypr/ ~/.config/DankMaterialShell/ ~/.config/kitty/ \
                 ~/.config/gtk-3.0/ ~/.config/gtk-4.0/ ~/.config/matugen/ \
                 ~/.config/danksearch/ ~/.config/starship/ ~/.local/bin/ \
                 ~/.gitignore ~/README.md

# Commit if there are changes; if not, just continue
$CONFIG_CMD commit -m "Rice Update: $(date +'%Y-%m-%d %H:%M')" || echo "No local changes to commit"

# 2. Pull remote changes SECOND
# Now that local changes are committed, rebase will work flawlessly
$CONFIG_CMD pull --rebase origin main

# 3. Push to GitHub
$CONFIG_CMD push origin main
notify-send "Rice Sync" "hypr-dots backup successful"
