# DankLinux System Documentation
**Last Updated:** January 26, 2026  
**Owner:** Duane Cummins  
**System:** Custom Arch Linux Distribution

---

## Table of Contents
1. [System Overview](#system-overview)
2. [Core Components](#core-components)
3. [Git Bare Repository Setup](#git-bare-repository-setup)
4. [File Structure](#file-structure)
5. [Configuration Management](#configuration-management)
6. [Backup Strategy](#backup-strategy)
7. [Scripts & Automation](#scripts--automation)
8. [Color Theme System](#color-theme-system)
9. [Troubleshooting](#troubleshooting)

---

## System Overview

### Base System
- **Distribution:** Arch Linux (custom "DankLinux" build)
- **Window Manager:** Hyprland (Wayland compositor)
- **Shell:** DankMaterialShell (custom GNOME Shell fork)
- **Terminal:** Kitty
- **Location:** Allen, Texas, US

### Key Features
- Material Design themed environment
- Matugen-based color generation from wallpapers
- Git bare repository for dotfile management
- Automated nightly backups with Timeshift

---

## Core Components

### DankMaterialShell (DMS)
- **Location:** `~/.config/DankMaterialShell/`
- **Type:** Custom GNOME Shell fork with Material Design
- **User Settings:** `~/.config/DankMaterialShell/settings.json` (tracked in git)
- **NOT Tracked in Git:**
  - `plugins/` - Downloaded via DMS interface
  - `themes/` - Downloaded via DMS interface  
  - `plugin_settings.json` - Auto-generated
  - `zen.css` - Auto-downloaded
  - `.changelog*` - Temporary files
  - `.firstlaunch` - Temporary file

### Hyprland
- **Location:** `~/.config/hypr/`
- **Main Config:** `~/.config/hypr/hyprland.conf`
- **DMS Integration:** `~/.config/hypr/dms/` directory contains:
  - `colors.conf` - Generated by Matugen
  - `binds.conf` - Keybindings
  - `cursor.conf` - Cursor settings
  - `env.conf` - Environment variables
  - `layout.conf` - Window layouts
  - `outputs.conf` - Monitor configuration

### Kitty Terminal
- **Location:** `~/.config/kitty/`
- **Theme Files:**
  - `dank-theme.conf` - Color scheme (Matugen-generated)
  - `dank-tabs.conf` - Tab bar styling (Matugen-generated)
  - `kitty.conf` - Main configuration

### Matugen (Color Generator)
- **Location:** `~/.config/matugen/`
- **Purpose:** Generates color schemes from wallpapers
- **Templates:** `~/.config/matugen/templates/`
- **Generates:**
  - Hyprland colors (`hypr/dms/colors.conf`)
  - Kitty themes (`kitty/dank-theme.conf`, `kitty/dank-tabs.conf`)
  - GTK themes (`gtk-4.0/dank-colors.css`)
  - Cava colors

### GTK Themes
- **GTK-3.0:** `~/.config/gtk-3.0/`
- **GTK-4.0:** `~/.config/gtk-4.0/`
  - `dank-colors.css` - Matugen-generated colors
  - `gtk.css` - Main stylesheet
  - `settings.ini` - GTK settings

### Cava (Audio Visualizer)
- **Location:** `~/.config/cava/`
- **Config:** `~/.config/cava/config`
- **Shaders:** `~/.config/cava/shaders/`
- **Themes:** `~/.config/cava/themes/`

### DankSearch
- **Location:** `~/.config/danksearch/`
- **Purpose:** Custom application launcher/search
- **Cache:** `~/.cache/danksearch/` (NOT tracked)

---

## Git Bare Repository Setup

### Repository Details
- **Local Bare Repo:** `~/hypr-dots/`
- **Work Tree:** `$HOME` (entire home directory)
- **GitHub Remote:** `https://github.com/dcindallas/hypr-dots.git`
- **Branch:** `main`

### Git Commands
All git operations use this format:
```bash
git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME <command>
```

### Exclude File Configuration
**Location:** `~/hypr-dots/info/exclude`

**Key Principles:**
1. Start with `*` to ignore everything by default
2. Whitelist only config directories with `!` prefix
3. Use `.config/` prefix in paths (how repo stores them)
4. Explicitly exclude auto-generated/downloaded files

**Current Whitelist:**
- `.bashrc`
- `.local/bin/**` (scripts)
- `Pictures/wallpaper/**`
- `.config/hypr/**`
- `.config/danksearch/**`
- `.config/DankMaterialShell/settings.json` (only user settings)
- `.config/gtk-3.0/**`
- `.config/gtk-4.0/**`
- `.config/kitty/**`
- `.config/matugen/**`
- `.config/cava/**`

**Critical Exclusions:**
```
.config/DankMaterialShell/plugins/
.config/DankMaterialShell/themes/
.config/DankMaterialShell/plugin_settings.json
.config/DankMaterialShell/zen.css
.config/DankMaterialShell/.changelog*
.config/DankMaterialShell/.firstlaunch
```

### Important Git Rules
1. **NEVER use `git add -f`** - This bypasses all safety checks
2. **NEVER track cache directories** - They're large and temporary
3. **NEVER track nested git repos** - Breaks bare repo structure
4. **NEVER track auto-downloaded files** - They regenerate on new installs
5. **ALWAYS check status before committing** - Verify no unwanted files

---

## File Structure

### Tracked Files (in Git)
```
~/
├── .bashrc
├── .local/
│   └── bin/
│       ├── hyper-push (sync script)
│       └── [other custom scripts]
├── Pictures/
│   └── wallpaper/
│       └── [wallpaper images]
└── .config/
    ├── hypr/
    │   ├── hyprland.conf
    │   └── dms/
    │       ├── colors.conf
    │       ├── binds.conf
    │       ├── cursor.conf
    │       ├── env.conf
    │       ├── layout.conf
    │       └── outputs.conf
    ├── DankMaterialShell/
    │   └── settings.json (ONLY this file)
    ├── kitty/
    │   ├── kitty.conf
    │   ├── dank-theme.conf
    │   └── dank-tabs.conf
    ├── gtk-3.0/
    │   └── [all files]
    ├── gtk-4.0/
    │   ├── gtk.css
    │   ├── settings.ini
    │   └── dank-colors.css
    ├── matugen/
    │   ├── config.toml
    │   └── templates/
    ├── cava/
    │   ├── config
    │   ├── shaders/
    │   └── themes/
    └── danksearch/
        └── [config files]
```

### NOT Tracked (Excluded)
```
~/.cache/                           # All cache files
~/.config/DankMaterialShell/
├── plugins/                        # Downloaded via DMS
├── themes/                         # Downloaded via DMS
├── plugin_settings.json            # Auto-generated
├── zen.css                         # Auto-downloaded
├── .changelog*                     # Temporary
└── .firstlaunch                    # Temporary
```

---

## Configuration Management

### Workflow for Config Changes
1. Edit config files normally
2. Run `hyper-push` to sync (manual or automatic at 11pm)
3. Script stages only modified tracked files
4. Commits with timestamp
5. Pulls with rebase
6. Pushes to GitHub

### Fresh Install Restoration
```bash
# 1. Install base system (Arch + Hyprland)
# 2. Clone bare repository
git clone --bare https://github.com/dcindallas/hypr-dots.git $HOME/hypr-dots

# 3. Checkout files (may need to backup conflicting files first)
git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME checkout main

# 4. Install DankMaterialShell
# (Installation method TBD - document when known)

# 5. Install DMS plugins via interface
# (Plugins are NOT in git, must be re-downloaded)

# 6. Verify exclude file
cat ~/hypr-dots/info/exclude

# 7. Test sync script
hyper-push
```

### Adding New Config Directories
To track a new config directory:

1. Edit exclude file:
```bash
nano ~/hypr-dots/info/exclude
```

2. Add whitelist entry:
```
!.config/newapp/
!.config/newapp/**
```

3. Stage and commit:
```bash
git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME add .config/newapp/
git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME commit -m "Add newapp config"
git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME push origin main
```

---

## Backup Strategy

### Timeshift Backup
- **Schedule:** Daily at 12:00 AM (midnight)
- **Type:** System snapshot
- **Purpose:** Full system recovery point

### Git Sync (hyper-push)
- **Schedule:** Daily at 11:00 PM
- **Type:** Configuration files only
- **Purpose:** Version control and remote backup of dotfiles
- **Runs:** 1 hour before Timeshift to ensure configs are saved

### Why Both?
- **Timeshift:** Full system state, can restore everything including installed packages
- **Git:** Portable configs, can apply to fresh installs, version history

---

## Scripts & Automation

### hyper-push Script
**Location:** `~/.local/bin/hyper-push`  
**Purpose:** Safe git sync without force-adding files

**Features:**
- Checks for changes before running
- Stages only modified tracked files
- Never uses `-f` flag
- Commits with timestamp
- Pulls with rebase
- Pushes to GitHub
- Sends desktop notifications

**Usage:**
```bash
hyper-push
```

**Cron Schedule (11pm daily):**
```cron
0 23 * * * /home/duane/.local/bin/hyper-push
```

### Setting Up Automated Sync
```bash
# Open crontab
crontab -e

# Add this line:
0 23 * * * /home/duane/.local/bin/hyper-push

# Verify it's scheduled
crontab -l
```

---

## Color Theme System

### Matugen Workflow
1. User selects wallpaper in `~/Pictures/wallpaper/`
2. Matugen extracts color palette from wallpaper
3. Generates color configs from templates:
   - `~/.config/hypr/dms/colors.conf`
   - `~/.config/kitty/dank-theme.conf`
   - `~/.config/kitty/dank-tabs.conf`
   - `~/.config/gtk-4.0/dank-colors.css`
   - Cava colors

### Template Locations
- **Matugen templates:** `~/.config/matugen/templates/`
- Templates use Matugen's template syntax to inject colors

### Applying Theme Changes
After Matugen generates new colors:
1. Hyprland reloads automatically (if configured)
2. Kitty requires restart or `kitty @ set-colors`
3. GTK apps pick up changes on next launch
4. Run `hyper-push` to save color changes to git

---

## Troubleshooting

### Git Shows Thousands of Untracked Files
**Symptom:** `git status -u` shows cache files, bash_history, etc.

**Cause:** Exclude file missing `*` at top or incorrect whitelist format

**Fix:**
```bash
# Check exclude file
cat ~/hypr-dots/info/exclude

# Should start with:
# Ignore everything by default
*

# Then whitelist with ! prefix
!.config/
!.config/hypr/
# etc...
```

### Can't Add Files - "Ignored by .gitignore"
**Symptom:** `git add` fails with "paths are ignored" error

**Cause:** Directory not whitelisted in exclude file

**Fix:**
```bash
# Check what's ignoring it
git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME check-ignore -v <path>

# Add to exclude file
nano ~/hypr-dots/info/exclude
# Add: !.config/directory/
```

### Repository Tracking Wrong Files
**Symptom:** Plugins, cache files, or themes are being tracked

**Cause:** Previous use of `git add -f` bypassed exclude rules

**Fix:**
```bash
# Remove from tracking (keeps local files)
git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME rm --cached -r <path>

# Commit removal
git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME commit -m "Remove unwanted files"

# Push
git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME push origin main
```

### DMS Plugins Disappeared After Git Checkout
**Symptom:** Plugins missing after restoring from git

**Cause:** Plugins are NOT tracked in git (intentionally)

**Fix:**
Re-download plugins via DankMaterialShell interface. This is by design - plugins should be managed through DMS, not git.

### Merge Conflicts After Pull
**Symptom:** `git pull` fails with conflicts

**Fix:**
```bash
# See conflicted files
git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME status

# Option 1: Keep your version
git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME checkout --ours <file>

# Option 2: Keep remote version  
git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME checkout --theirs <file>

# Option 3: Manually resolve
nano <file>

# After resolving
git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME add <file>
git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME rebase --continue
```

---

## Key Learnings (From Repair Session)

### What Went Wrong with Previous Setup
1. **Used `git add -f` on entire directories** - Tracked 100+ plugin files
2. **Tracked nested git repos** - Broke bare repo structure
3. **No `*` at top of exclude file** - Didn't ignore by default
4. **Tracked auto-generated files** - zen.css, plugin_settings.json
5. **Wrong path format in exclude** - Mixed with/without `.config/` prefix

### Best Practices Established
1. **Always start exclude with `*`** - Explicit whitelist only
2. **Never use `-f` flag** - If git won't add it, there's a reason
3. **Check status before committing** - Verify no cache/temp files
4. **Keep auto-generated files out** - They regenerate anyway
5. **Document what's tracked** - This file serves that purpose
6. **One-step-at-a-time workflow** - Easier to catch errors early

### Bare Repo Path Format
Files are stored in git with `.config/` prefix:
```
.config/hypr/hyprland.conf
.config/kitty/kitty.conf
.config/DankMaterialShell/settings.json
```

But exclude file also needs this format for whitelisting.

---

## Health Consideration Notes

**Context:** User undergoing stage 4 cancer treatment with memory side effects

**Workflow Adaptations:**
- One command at a time, wait for confirmation
- Document everything in writing
- Scripts with clear notifications
- Automated backups (set and forget)
- This documentation file for reference

**Recovery Procedures:**
All critical procedures documented above with exact commands. In case of memory issues or system failure, this file contains everything needed to rebuild or fix the system.

---

## Future Enhancements / TODO

### Potential Additions
- [ ] Document DankMaterialShell installation procedure
- [ ] Create restore script for fresh installs
- [ ] Add pre-commit hooks to prevent tracking wrong files
- [ ] Document plugin list (if possible to export from DMS)
- [ ] Add Matugen template creation guide
- [ ] Create backup verification script
- [ ] Document hardware-specific configs (if any)

### Monitoring
- [ ] Verify hyper-push runs successfully at 11pm
- [ ] Verify Timeshift backups complete at 12am
- [ ] Check git repo size periodically (should stay small)
- [ ] Review exclude file if new apps are installed

---

## Quick Reference Commands

### Check Git Status
```bash
git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME status
```

### Manual Sync
```bash
hyper-push
```

### View Exclude Rules
```bash
cat ~/hypr-dots/info/exclude
```

### See What's Being Ignored
```bash
git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME check-ignore -v <path>
```

### List Tracked Files
```bash
git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME ls-files
```

### View Recent Commits
```bash
git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME log --oneline -10
```

### Emergency: Reset to Remote
```bash
git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME fetch origin
git --git-dir=$HOME/hypr-dots/ --work-tree=$HOME reset --hard origin/main
```

---

## Support Contacts

- **GitHub Issues:** https://github.com/dcindallas/hypr-dots/issues
- **Arch Wiki:** https://wiki.archlinux.org/
- **Hyprland Docs:** https://wiki.hyprland.org/

---

**Document Status:** Living document - update as system evolves  
**Git Location:** Consider adding this to `~/hypr-dots/` as `SYSTEM-DOCS.md`
